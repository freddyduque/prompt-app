<?php
session_start();
include_once '../../includes/db_connect.php';

if(isset($_SESSION['UserSession'])){
  header("Location: prompt-main/index.html");
  $mysqli->close();
  exit;
}

if(isset($_POST['btn-login'])){
  $email = $mysqli->real_escape_string(trim($_POST['inputEmail']));
  $upass = $mysqli->real_escape_string(trim($_POST['password']));
  
  $query = $mysqli->query("SELECT * FROM SVF_USER WHERE EMAIL='".$email."' OR USERNAME='".$email."';");
  $row = $query->fetch_array();
  
  if(strcmp( $upass, $row['PASSWORD']) == 0  ){          //if(password_verify($upass, $row['password'])){
    $_SESSION['UserSession'] = $row['IDUSER'];
    $_SESSION['UserName'] = $row['FIRST_NAME'];
    $_SESSION['UserLastName'] = $row['LAST_NAME'];
    $_SESSION['UserEmail'] = $row['EMAIL'];
    header("Location: prompt-main/index.html");
  }else
    $msg = "<div class='alert alert-danger alert-dismissible' role='alert'>
      <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>
      <strong>Email</strong> or <strong>Password</strong> doesn't exists!
    </div>";
  $mysqli->close();
}
?>
  <!DOCTYPE html>
  <html>

  <head>
    <meta charset="utf-8">
    <title>SVF.prompt</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Freddy Duque">
    <meta name="description" content="SVF Order Manager Application">
    <meta name="keywords" content="">
    <meta name="application-name" content="SVF.prompt">

    <meta name="msapplication-TileColor" content="#337ab7">

    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/internal.css">
    <link rel="stylesheet" href="css/awesome-bootstrap-checkbox.css">

  </head>

  <body class="login-page">
    <nav class="navbar navbar-default">
      <div class="navbar-header">
        <a class="navbar-brand navbar-brand-custom" href="http://www.svf-international.com">SVF<span class="slogan slogan-custom">.prompt</span></a>
        <a href="#" title="Cambiar a Español" class="navbar-link">
          <p class="navbar-text"><img alt="Español" src="img/es.png">Español</p>
        </a>
      </div>
    </nav>
    <div class="container login-container">
      <div class="login-panel panel panel-default plain">
        <div class="panel-body">
          <?php if(isset($msg))echo $msg;?>
            <p class="text-center"><span class="navbar-brand-custom">SVF</span><span class="slogan slogan-custom">.prompt</span></p>
            <form method="POST" action="index.html" class="form-horizontal mt0" id="login-form" role="form">
              <div class="form-group">
                <div class="col-md-12">
                  <label for="inputEmail">Username</label>
                </div>
                <div class="col-lg-12">
                  <div class="input-group">
                    <input type="email" class="form-control" name="inputEmail" id="inputEmail" aria-required="true" aria-invalid="true" placeholder="Your username" required>
                    <span class="input-group-addon">
                    <span class="glyphicon glyphicon-envelope"></span>
                    </span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <div class="col-md-12">
                  <label for="password">Password</label>
                </div>
                <div class="col-lg-12">
                  <div class="input-group">
                    <input aria-invalid="false" aria-required="true" name="password" id="password" class="form-control valid" type="password" placeholder="Your password" required>
                    <span class="input-group-addon">
                    <span class="glyphicon glyphicon-lock"></span>
                    </span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <!--
              <div class="col-lg-6 col-md-6 col-sm-6 col-xs-8">    
                <div class="checkbox">
                  <input type="checkbox" id="checkbox-custom-01"><label for="checkbox-custom-01">Remember me?</label>                      
                </div>
              </div>  
              <div class="col-lg-6 col-md-6 col-sm-6 col-xs-4 "> pull-right
              -->
                <div class="col-md-12">
                  <button type="submit" class="btn btn-primary btn-block" name="btn-login" id="btn-login">Login <span class="glyphicon glyphicon-user"></span></button>
                </div>
              </div>
            </form>
            <div class="col-xs-12"></div>
            <span class="help-block text-center"><a data-toggle="collapse" data-target="#panel-footer-01" style="text-decoration: none;cursor: pointer">Forgot your password?</a></span>
        </div>
        <div class="panel-footer gray-lighter-bg collapse" id="panel-footer-01">
          <p class="text-center" style="padding-top: 15px">Enter your username to retrive your password.</p>
          <form role="form" class="form-horizontal mt0" action="index.html" id="login-form">
            <div class="form-group">
              <div class="col-lg-12">
                <div class="input-group">
                  <input type="email" aria-invalid="false" aria-required="true" name="email-retrive" id="email-retrive" class="form-control valid" placeholder="Your username" required>
                  <span class="input-group-addon">
                    <span class="glyphicon glyphicon-envelope"></span>
                  </span>
                </div>
              </div>
            </div>
            <div class="form-group" style="margin-bottom: 0px;padding-bottom:15px">
              <div class="col-md-12">
                <button type="button" class="btn btn-primary btn-block">Retrive</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="footer">
        <p class="text-center">SVF INTERNATIONAL, N.V. | ©2015 Copyright | All rights reserved.</p>
      </div>
    </div>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>

  </html>
